import pandas as pd
import numpy as np
import pymc3 as pm
import arviz as az

# 데이터 로드 및 전처리
wine = pd.read_csv('winequality.csv')
wine_clean = wine[(np.abs(stats.zscore(wine.iloc[:,:-1])) < 3).all(axis=1)]
X = (wine_clean.iloc[:,:-1] - wine_clean.iloc[:,:-1].mean())/wine_clean.iloc[:,:-1].std()
y = wine_clean['quality']

with pm.Model() as model:
    # 사전분포: N(0,1)
    beta = pm.Normal('beta', mu=0, sigma=1, shape=X.shape[1])
    alpha = pm.Normal('alpha', mu=y.mean(), sigma=1)
    sigma = pm.HalfNormal('sigma', sigma=1)
    
    mu = alpha + pm.math.dot(X, beta)
    likelihood = pm.Normal('y', mu=mu, sigma=sigma, observed=y)
    
    trace = pm.sample(2000, tune=2000, cores=4)

# 상호작용 모델
with pm.Model() as interaction_model:
    beta = pm.Normal('beta', mu=0, sigma=1, shape=X.shape[1])
    interaction = pm.Normal('interaction', mu=0, sigma=1)
    
    mu = (alpha + pm.math.dot(X, beta) 
          + interaction * X['alcohol'] * X['volatile acidity'])
    likelihood = pm.Normal('y', mu=mu, sigma=sigma, observed=y)
    
    trace_interaction = pm.sample(2000, tune=2000)
